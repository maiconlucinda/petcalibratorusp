2025-11-10 11:22:25 - INFO - ======================================================================
2025-11-10 11:22:25 - INFO - PET THERMAL COMFORT CALIBRATOR
2025-11-10 11:22:25 - INFO - Autora: Carol Freire do Santos
2025-11-10 11:22:25 - INFO - Instituição: Universidade de São Paulo (USP)
2025-11-10 11:22:25 - INFO - Programa: Doutorado em Climatologia
2025-11-10 11:22:25 - INFO - ======================================================================
2025-11-10 11:22:25 - INFO - Input file: examples/sample_data.csv
2025-11-10 11:22:25 - INFO - Output directory: test_final
2025-11-10 11:22:25 - INFO - Column mapping file: examples/column_mapping.json
2025-11-10 11:22:25 - INFO - Verbose mode: False
2025-11-10 11:22:25 - INFO - ======================================================================
2025-11-10 11:22:25 - INFO - 
[STEP 1/10] Loading input data...
2025-11-10 11:22:25 - INFO - Loading data from examples/sample_data.csv
2025-11-10 11:22:25 - INFO - Successfully loaded CSV file with 150 rows and 4 columns
2025-11-10 11:22:25 - INFO - ✓ Loaded 150 rows and 4 columns
2025-11-10 11:22:25 - INFO - 
[STEP 2/10] Applying column mapping...
2025-11-10 11:22:25 - INFO - Loading column mapping from examples/column_mapping.json
2025-11-10 11:22:25 - INFO - Successfully loaded column mapping with 4 entries
2025-11-10 11:22:25 - INFO - Applied column mapping: renamed 4 columns
2025-11-10 11:22:25 - INFO - ✓ Column mapping applied
2025-11-10 11:22:25 - INFO - 
[STEP 3/10] Validating required columns...
2025-11-10 11:22:25 - INFO - All required columns are present (PET_C, Sensation)
2025-11-10 11:22:25 - INFO - ✓ All required columns present
2025-11-10 11:22:25 - INFO - 
[STEP 4/10] Cleaning and preparing data...
2025-11-10 11:22:25 - INFO - Mapping sensation values to ordinal scale
2025-11-10 11:22:25 - INFO - Successfully mapped 150 rows to ordinal scale
2025-11-10 11:22:25 - INFO - Sensation distribution:
2025-11-10 11:22:25 - INFO -   Muito Frio (-3): 11 responses
2025-11-10 11:22:25 - INFO -   Frio (-2): 16 responses
2025-11-10 11:22:25 - INFO -   Frio Moderado (-1): 27 responses
2025-11-10 11:22:25 - INFO -   Confortável (+0): 42 responses
2025-11-10 11:22:25 - INFO -   Calor Moderado (+1): 27 responses
2025-11-10 11:22:25 - INFO -   Quente (+2): 16 responses
2025-11-10 11:22:25 - INFO -   Muito Quente (+3): 11 responses
2025-11-10 11:22:25 - INFO - Validating PET values in column 'PET_C'
2025-11-10 11:22:25 - INFO - PET statistics for valid values:
2025-11-10 11:22:25 - INFO -   Mean: 23.98°C
2025-11-10 11:22:25 - INFO -   Median: 24.10°C
2025-11-10 11:22:25 - INFO -   Std Dev: 7.60°C
2025-11-10 11:22:25 - INFO -   Range: [5.20, 41.90]°C
2025-11-10 11:22:25 - INFO - Removing invalid rows
2025-11-10 11:22:25 - INFO - Data cleaning summary:
2025-11-10 11:22:25 - INFO -   Total rows: 150
2025-11-10 11:22:25 - INFO -   Rows with invalid PET: 0
2025-11-10 11:22:25 - INFO -   Rows with invalid sensation: 0
2025-11-10 11:22:25 - INFO -   Rows with both invalid: 0
2025-11-10 11:22:25 - INFO -   Total rows removed: 0
2025-11-10 11:22:25 - INFO -   Rows retained: 150 (100.0%)
2025-11-10 11:22:25 - INFO - ✓ Data cleaning complete: 150 valid rows retained
2025-11-10 11:22:25 - INFO - 
[STEP 5/10] Saving cleaned data...
2025-11-10 11:22:25 - INFO - Saving cleaned data to test_final/respostas_com_PET.csv
2025-11-10 11:22:25 - INFO - Successfully saved 150 rows and 5 columns to test_final/respostas_com_PET.csv
2025-11-10 11:22:25 - INFO - ✓ Cleaned data saved to test_final/respostas_com_PET.csv
2025-11-10 11:22:25 - INFO - 
[STEP 6/10] Fitting ordinal regression model...
2025-11-10 11:22:25 - INFO - Fitting ordinal regression model with 150 observations
2025-11-10 11:22:25 - INFO - Fitting model with logit link function...
2025-11-10 11:22:25 - INFO - Model converged successfully
2025-11-10 11:22:25 - INFO - Log-likelihood: -37.14
2025-11-10 11:22:25 - INFO - AIC: 88.28
2025-11-10 11:22:25 - INFO - BIC: 109.35
2025-11-10 11:22:25 - INFO - ✓ Model fitted successfully
2025-11-10 11:22:25 - INFO - Extracting model parameters
2025-11-10 11:22:25 - INFO - Beta coefficient (PET_C): 2.1641 (SE: 0.3190)
2025-11-10 11:22:25 - INFO - Cutpoints (thresholds):
2025-11-10 11:22:25 - INFO -   τ_-3 = 2.1482 (SE: 0.1854)
2025-11-10 11:22:25 - INFO -   τ_-2 = 2.2938 (SE: 0.2077)
2025-11-10 11:22:25 - INFO -   τ_-1 = 27.7411 (SE: 4.3127)
2025-11-10 11:22:25 - INFO -   τ_+0 = 2.3433 (SE: 0.1651)
2025-11-10 11:22:25 - INFO -   τ_+1 = 2.1940 (SE: 0.1790)
2025-11-10 11:22:25 - INFO -   τ_+2 = 2.6208 (SE: 0.1936)
2025-11-10 11:22:25 - INFO - Model fit statistics:
2025-11-10 11:22:25 - INFO -   N observations: 150
2025-11-10 11:22:25 - INFO -   Log-likelihood: -37.14
2025-11-10 11:22:25 - INFO -   AIC: 88.28
2025-11-10 11:22:25 - INFO -   BIC: 109.35
2025-11-10 11:22:25 - INFO -   Converged: True
2025-11-10 11:22:25 - INFO - Calculating 95% confidence intervals
2025-11-10 11:22:25 - INFO - Beta CI: [1.5388, 2.7893] (point estimate: 2.1641)
2025-11-10 11:22:25 - INFO - Cutpoint confidence intervals:
2025-11-10 11:22:25 - INFO -   τ_-3 CI: [1.7849, 2.5115] (point estimate: 2.1482)
2025-11-10 11:22:25 - INFO -   τ_-2 CI: [1.8867, 2.7009] (point estimate: 2.2938)
2025-11-10 11:22:25 - INFO -   τ_-1 CI: [19.2884, 36.1938] (point estimate: 27.7411)
2025-11-10 11:22:25 - INFO -   τ_+0 CI: [2.0196, 2.6670] (point estimate: 2.3433)
2025-11-10 11:22:25 - INFO -   τ_+1 CI: [1.8433, 2.5448] (point estimate: 2.1940)
2025-11-10 11:22:25 - INFO -   τ_+2 CI: [2.2413, 3.0002] (point estimate: 2.6208)
2025-11-10 11:22:25 - INFO - 
[STEP 7/10] Calculating comfort metrics...
2025-11-10 11:22:25 - INFO - Calculating PET neutral
2025-11-10 11:22:25 - INFO - PET neutral = τ_0 / β = 2.3433 / 2.1641 = 1.08°C
2025-11-10 11:22:25 - INFO - PET neutral: 1.08°C (95% CI: [0.74, 1.43]°C, SE: 0.18)
2025-11-10 11:22:25 - INFO - Calculating probability distributions across PET range
2025-11-10 11:22:25 - INFO - PET grid: -5.0°C to 55.0°C, step 0.05°C (1201 points)
2025-11-10 11:22:25 - INFO - Calculating cumulative probabilities for each threshold:
2025-11-10 11:22:25 - INFO - Calculating category probabilities:
2025-11-10 11:22:25 - INFO - Comfort probability: max = -0.000 at PET = 55.00°C
2025-11-10 11:22:25 - INFO - Calculating comfort bands for thresholds: [0.8, 0.9]
2025-11-10 11:22:25 - INFO - Finding comfort band for 80% threshold
2025-11-10 11:22:25 - WARNING - No PET values found where comfort probability >= 0.80. Maximum comfort probability: -0.000
2025-11-10 11:22:25 - INFO - Finding comfort band for 90% threshold
2025-11-10 11:22:25 - WARNING - No PET values found where comfort probability >= 0.90. Maximum comfort probability: -0.000
2025-11-10 11:22:25 - INFO - Calculating PET ranges for each thermal sensation category
2025-11-10 11:22:25 - INFO - Analyzing category -3 (Muito Frio)
2025-11-10 11:22:25 - INFO -   Modal range: [-5.0, 1.0]°C (peak at -5.0°C, prob=1.000)
2025-11-10 11:22:25 - INFO -   Threshold range (≥30%): [-5.0, 1.3]°C
2025-11-10 11:22:25 - INFO -   Observed PET: mean=9.9°C, median=9.7°C, range=[5.2, 13.9]°C (n=11)
2025-11-10 11:22:25 - INFO - Analyzing category -2 (Frio)
2025-11-10 11:22:25 - INFO -   No modal range found (category never most probable)
2025-11-10 11:22:25 - INFO -   No range found with probability ≥ 30%
2025-11-10 11:22:25 - INFO -   Observed PET: mean=14.9°C, median=14.9°C, range=[13.0, 17.2]°C (n=16)
2025-11-10 11:22:25 - INFO - Analyzing category -1 (Frio Moderado)
2025-11-10 11:22:25 - INFO -   Modal range: [1.0, 6.7]°C (peak at 6.7°C, prob=1.000)
2025-11-10 11:22:25 - INFO -   Threshold range (≥30%): [0.7, 13.2]°C
2025-11-10 11:22:25 - INFO -   Observed PET: mean=19.7°C, median=19.5°C, range=[18.5, 21.5]°C (n=27)
2025-11-10 11:22:25 - INFO - Analyzing category +0 (Confortável)
2025-11-10 11:22:25 - INFO -   No modal range found (category never most probable)
2025-11-10 11:22:25 - INFO -   No range found with probability ≥ 30%
2025-11-10 11:22:25 - INFO -   Observed PET: mean=23.9°C, median=24.1°C, range=[21.1, 27.7]°C (n=42)
2025-11-10 11:22:25 - INFO - Analyzing category +1 (Calor Moderado)
2025-11-10 11:22:25 - INFO -   No modal range found (category never most probable)
2025-11-10 11:22:25 - INFO -   No range found with probability ≥ 30%
2025-11-10 11:22:25 - INFO -   Observed PET: mean=28.0°C, median=28.1°C, range=[25.7, 30.8]°C (n=27)
2025-11-10 11:22:25 - INFO - Analyzing category +2 (Quente)
2025-11-10 11:22:25 - INFO -   No modal range found (category never most probable)
2025-11-10 11:22:25 - INFO -   No range found with probability ≥ 30%
2025-11-10 11:22:25 - INFO -   Observed PET: mean=33.2°C, median=33.4°C, range=[29.2, 38.0]°C (n=16)
2025-11-10 11:22:25 - INFO - Analyzing category +3 (Muito Quente)
2025-11-10 11:22:25 - INFO -   Modal range: [6.7, 55.0]°C (peak at 18.5°C, prob=1.000)
2025-11-10 11:22:25 - INFO -   Threshold range (≥30%): [0.8, 55.0]°C
2025-11-10 11:22:25 - INFO -   Observed PET: mean=38.9°C, median=39.2°C, range=[33.9, 41.9]°C (n=11)
2025-11-10 11:22:25 - INFO - ✓ Category PET ranges calculated
2025-11-10 11:22:25 - INFO - >>> CALCULATING OBSERVED PET RANGES <<<
2025-11-10 11:22:25 - INFO - Calculating observed PET ranges (descriptive statistics)
2025-11-10 11:22:25 - INFO -   Muito Frio: n=11, mean=9.9°C, 50%=[9.1, 11.3]°C, 80%=[7.5, 11.9]°C
2025-11-10 11:22:25 - INFO -   Frio: n=16, mean=14.9°C, 50%=[14.2, 15.4]°C, 80%=[13.3, 16.1]°C
2025-11-10 11:22:25 - INFO -   Frio Moderado: n=27, mean=19.7°C, 50%=[18.9, 20.4]°C, 80%=[18.7, 20.8]°C
2025-11-10 11:22:25 - INFO -   Confortável: n=42, mean=23.9°C, 50%=[22.9, 24.5]°C, 80%=[21.9, 25.5]°C
2025-11-10 11:22:25 - INFO -   Calor Moderado: n=27, mean=28.0°C, 50%=[26.8, 28.7]°C, 80%=[26.5, 29.3]°C
2025-11-10 11:22:25 - INFO -   Quente: n=16, mean=33.2°C, 50%=[31.6, 34.3]°C, 80%=[30.8, 35.5]°C
2025-11-10 11:22:25 - INFO -   Muito Quente: n=11, mean=38.9°C, 50%=[37.7, 40.5]°C, 80%=[37.3, 41.4]°C
2025-11-10 11:22:25 - INFO - ✓ Observed PET ranges calculated
2025-11-10 11:22:25 - INFO - >>> OBSERVED RANGES: 7 categories <<<
2025-11-10 11:22:25 - INFO - ✓ Comfort metrics calculated
2025-11-10 11:22:25 - INFO - 
[STEP 8/10] Analyzing acceptability (optional)...
2025-11-10 11:22:25 - INFO - Checking for acceptability column: 'Acceptability'
2025-11-10 11:22:25 - INFO - Found acceptability column with 150 non-null values
2025-11-10 11:22:25 - INFO - Acceptability distribution:
2025-11-10 11:22:25 - INFO -   Acceptable (1): 96 responses
2025-11-10 11:22:25 - INFO -   Unacceptable (0): 54 responses
2025-11-10 11:22:25 - INFO - Acceptability column is valid and ready for analysis
2025-11-10 11:22:25 - INFO - Acceptability data found, fitting model...
2025-11-10 11:22:25 - INFO - Fitting binary logistic regression for acceptability
2025-11-10 11:22:25 - INFO - Fitting acceptability model with 150 observations
2025-11-10 11:22:25 - INFO - Acceptability model converged successfully
2025-11-10 11:22:25 - INFO - Model coefficients:
2025-11-10 11:22:25 - INFO -   Intercept: 1.2266 (SE: 0.5798)
2025-11-10 11:22:25 - INFO -   PET_C: -0.0269 (SE: 0.0227)
2025-11-10 11:22:25 - INFO -   Log-likelihood: -97.30
2025-11-10 11:22:25 - INFO -   AIC: 198.60
2025-11-10 11:22:25 - INFO -   BIC: 204.63
2025-11-10 11:22:25 - INFO - Calculating acceptability bands for thresholds: [0.8, 0.9]
2025-11-10 11:22:25 - INFO - Acceptability probability range: [0.437 at 55.0°C, 0.796 at -5.0°C]
2025-11-10 11:22:25 - INFO - Finding acceptability band for 80% threshold
2025-11-10 11:22:25 - WARNING - No PET values found where acceptability >= 0.80. Maximum acceptability: 0.796
2025-11-10 11:22:25 - INFO - Finding acceptability band for 90% threshold
2025-11-10 11:22:25 - WARNING - No PET values found where acceptability >= 0.90. Maximum acceptability: 0.796
2025-11-10 11:22:25 - INFO - ✓ Acceptability analysis complete
2025-11-10 11:22:25 - INFO - 
[STEP 9/10] Generating visualizations...
2025-11-10 11:22:25 - INFO - Creating scatter plot...
2025-11-10 11:22:25 - INFO - Creating scatter plot: TSV vs PET
2025-11-10 11:22:25 - INFO - Saved scatter plot to test_final/scatter_TSV_PET.png
2025-11-10 11:22:25 - INFO - Creating probability curves plot...
2025-11-10 11:22:25 - INFO - Creating probability curves plot
2025-11-10 11:22:26 - INFO - Saved probability curves plot to test_final/probs_ordinais_PET.png
2025-11-10 11:22:26 - INFO - Creating comfort zone plot...
2025-11-10 11:22:26 - INFO - Creating comfort zone plot
2025-11-10 11:22:26 - INFO - Saved comfort zone plot to test_final/zona_conforto_logit.png
2025-11-10 11:22:26 - INFO - ✓ All visualizations generated
2025-11-10 11:22:26 - INFO - 
[STEP 10/10] Generating report...
2025-11-10 11:22:26 - INFO - Calculating descriptive statistics for report
2025-11-10 11:22:26 - INFO - PET statistics: mean=23.98, median=24.10, std=7.60, range=[5.20, 41.90]
2025-11-10 11:22:26 - INFO - Sensation distribution: 7 categories, 150 total observations
2025-11-10 11:22:26 - INFO - Generating Markdown report
2025-11-10 11:22:26 - INFO - Formatting model results section
2025-11-10 11:22:26 - INFO - Formatting comfort metrics section
2025-11-10 11:22:26 - ERROR - 
======================================================================
2025-11-10 11:22:26 - ERROR - ERRO INESPERADO
2025-11-10 11:22:26 - ERROR - ======================================================================
2025-11-10 11:22:26 - ERROR - 
NameError: name 'observed_ranges' is not defined

2025-11-10 11:22:26 - ERROR - Traceback completo:
2025-11-10 11:22:26 - ERROR - Traceback (most recent call last):
  File "/Users/maiconc/Documents/petCalibrator/pet_calibrator.py", line 3531, in main
    report_file = generate_markdown_report(
  File "/Users/maiconc/Documents/petCalibrator/pet_calibrator.py", line 2877, in generate_markdown_report
    comfort_section = format_comfort_metrics_section(
  File "/Users/maiconc/Documents/petCalibrator/pet_calibrator.py", line 2728, in format_comfort_metrics_section
    if observed_ranges is not None:
NameError: name 'observed_ranges' is not defined

2025-11-10 11:22:26 - ERROR - ======================================================================
2025-11-10 11:22:26 - ERROR - 
Por favor, verifique os dados de entrada e tente novamente.
2025-11-10 11:22:26 - ERROR - Se o problema persistir, contate o desenvolvedor.
2025-11-10 11:22:26 - ERROR - ======================================================================
